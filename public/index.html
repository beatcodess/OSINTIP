<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RECON // BEATCODES</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:#020403;
  font-family:"JetBrains Mono", monospace;
  color:#9affb2;
  overflow:hidden;
}

/* ================= INTRO ================= */

#intro{
  position:fixed;
  inset:0;
  background:radial-gradient(circle,#031a0c,#000);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  transition:opacity .8s ease;
}

#lock{
  display:flex;
  gap:10px;
}

.dial{
  width:64px;
  height:86px;
  border-radius:12px;
  background:rgba(0,255,120,.08);
  backdrop-filter:blur(10px);
  box-shadow:
    inset 0 0 18px rgba(0,255,120,.35),
    0 0 20px rgba(0,255,120,.25);
  overflow:hidden;
}

.strip{
  position:relative;
  transition:transform 1.2s cubic-bezier(.22,.61,.36,1);
}

.strip span{
  display:block;
  height:86px;
  line-height:86px;
  font-size:42px;
  text-align:center;
  font-weight:700;
}

/* ================= APP ================= */

#app{
  opacity:0;
  transition:opacity 1s ease;
  padding:40px;
  height:100vh;
  overflow:auto;
}

.show #app{opacity:1}

.panel{
  max-width:560px;
  margin:60px auto;
  padding:30px;
  background:rgba(0,255,120,.07);
  backdrop-filter:blur(14px);
  border-radius:18px;
  box-shadow:
    0 0 35px rgba(0,255,120,.35),
    inset 0 0 25px rgba(0,255,120,.15);
}

h1{
  text-align:center;
  letter-spacing:4px;
  text-shadow:0 0 14px #00ff88;
}

input,button{
  width:100%;
  padding:14px;
  margin-top:14px;
  background:#001b0a;
  border:1px solid rgba(0,255,120,.4);
  color:#9affb2;
  border-radius:10px;
  font-family:inherit;
}

button{
  background:linear-gradient(135deg,#00ff88,#009955);
  color:#001b0a;
  font-weight:700;
  cursor:pointer;
}

pre{
  margin-top:18px;
  padding:16px;
  min-height:120px;
  background:#000;
  border-radius:10px;
  font-size:13px;
  overflow:auto;
}

#map{
  height:260px;
  margin-top:18px;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 0 18px rgba(0,255,120,.25);
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro">
  <div id="lock"></div>
</div>

<!-- APP -->
<div id="app">
  <div class="panel">
    <h1>RECON ONLINE</h1>

    <input id="target" placeholder="TARGET IP / DOMAIN">
    <button onclick="run()">INITIATE RECON</button>

    <pre id="out">Awaiting targetâ€¦</pre>
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ================= BIKE LOCK LOGIC ================= */

const word = "BEATCODES";
const lock = document.getElementById("lock");
const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
const DIAL_HEIGHT = 86;

[...word].forEach((char, index) => {
  const dial = document.createElement("div");
  dial.className = "dial";

  const strip = document.createElement("div");
  strip.className = "strip";

  // Build rolling letters (2 full rotations + target)
  const rotations = 2;
  for(let r=0;r<rotations;r++){
    for(const l of letters){
      const s = document.createElement("span");
      s.textContent = l;
      strip.appendChild(s);
    }
  }

  const targetIndex = letters.indexOf(char);
  for(let i=0;i<=targetIndex;i++){
    const s = document.createElement("span");
    s.textContent = letters[i];
    strip.appendChild(s);
  }

  dial.appendChild(strip);
  lock.appendChild(dial);

  // Animate sequential stop
  requestAnimationFrame(()=>{
    const stopOffset = (strip.children.length - 1) * DIAL_HEIGHT;
    setTimeout(()=>{
      strip.style.transform = `translateY(-${stopOffset}px)`;
    }, index * 180);
  });
});

// Reveal app after final lock
setTimeout(()=>{
  document.getElementById("intro").style.opacity = 0;
}, word.length * 180 + 1200);

setTimeout(()=>{
  document.getElementById("intro").remove();
  document.body.classList.add("show");
}, word.length * 180 + 2000);

/* ================= RECON FUNCTIONALITY ================= */

let map, marker, circle;

async function run(){
  const t = document.getElementById("target").value;
  const out = document.getElementById("out");
  out.textContent = "> Connecting...\n> Gathering intelligence...\n";

  const r = await fetch("/api/recon",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({target:t})
  });

  const j = await r.json();
  out.textContent += JSON.stringify(j,null,2);

  if(j.geo?.lat && j.geo?.lon){
    if(!map){
      map = L.map("map").setView([j.geo.lat,j.geo.lon],7);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
    }else{
      map.setView([j.geo.lat,j.geo.lon],7);
      if(marker) map.removeLayer(marker);
      if(circle) map.removeLayer(circle);
    }

    marker = L.marker([j.geo.lat,j.geo.lon]).addTo(map);
    circle = L.circle([j.geo.lat,j.geo.lon],{
      radius: j.vpn_likelihood==="High"?90000:45000,
      color:"#00ff88",
      fillOpacity:.12
    }).addTo(map);
  }
}
</script>

</body>
</html>
