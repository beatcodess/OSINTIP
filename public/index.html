<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RECON // BEATCODES</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:#020403;
  font-family:"JetBrains Mono", monospace;
  color:#9affb2;
  overflow:hidden;
}

/* ================= INTRO ================= */

#intro{
  position:fixed;
  inset:0;
  background:radial-gradient(circle,#031a0c,#000);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

#lock{display:flex;gap:8px}

.dial{
  width:60px;
  height:80px;
  border-radius:10px;
  background:rgba(0,255,120,.08);
  backdrop-filter:blur(8px);
  box-shadow:inset 0 0 15px rgba(0,255,120,.35),0 0 18px rgba(0,255,120,.25);
  overflow:hidden;
}

.strip{
  animation:spin .12s linear infinite;
}

.strip span{
  display:block;
  height:80px;
  line-height:80px;
  font-size:42px;
  text-align:center;
  font-weight:700;
}

@keyframes spin{
  from{transform:translateY(0)}
  to{transform:translateY(-800px)}
}

/* ================= DOORS ================= */

.door{
  position:fixed;
  top:0;
  width:50%;
  height:100%;
  background:linear-gradient(to right,#001b0a,#003316);
  box-shadow:inset 0 0 40px rgba(0,255,120,.35);
  z-index:9000;
  transition:transform 1.6s cubic-bezier(.77,0,.18,1);
}

#leftDoor{left:0}
#rightDoor{right:0}

.open #leftDoor{transform:translateX(-100%)}
.open #rightDoor{transform:translateX(100%)}

/* ================= APP ================= */

#app{
  opacity:0;
  transition:opacity 1s ease;
  padding:40px;
  overflow:auto;
  height:100vh;
}

.open #app{opacity:1}

.panel{
  max-width:560px;
  margin:60px auto;
  padding:30px;
  background:rgba(0,255,120,.07);
  backdrop-filter:blur(14px);
  border-radius:18px;
  box-shadow:0 0 35px rgba(0,255,120,.35),inset 0 0 25px rgba(0,255,120,.15);
}

h1{
  text-align:center;
  letter-spacing:4px;
  color:#9affb2;
  text-shadow:0 0 14px #00ff88;
}

input,button{
  width:100%;
  padding:14px;
  margin-top:14px;
  background:#001b0a;
  border:1px solid rgba(0,255,120,.4);
  color:#9affb2;
  border-radius:10px;
  font-family:inherit;
}

button{
  background:linear-gradient(135deg,#00ff88,#009955);
  color:#001b0a;
  font-weight:700;
  cursor:pointer;
}

pre{
  margin-top:18px;
  padding:16px;
  min-height:120px;
  background:#000;
  border-radius:10px;
  font-size:13px;
  overflow:auto;
}

#map{
  height:260px;
  margin-top:18px;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 0 18px rgba(0,255,120,.25);
}

.meter{
  margin:16px 0;
  height:10px;
  background:#001b0a;
  border-radius:6px;
  overflow:hidden;
}

.meter span{
  display:block;
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00ff88,#9affb2);
  animation:load 2.5s ease forwards;
}

@keyframes load{to{width:100%}}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro"><div id="lock"></div></div>

<!-- DOORS -->
<div id="leftDoor" class="door"></div>
<div id="rightDoor" class="door"></div>

<!-- APP -->
<div id="app">
  <div class="panel">
    <h1>RECON ONLINE</h1>
    <div class="meter"><span></span></div>

    <input id="target" placeholder="TARGET IP / DOMAIN">
    <button onclick="run()">INITIATE RECON</button>

    <pre id="out">Awaiting targetâ€¦</pre>
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== INTRO LOGIC ===== */
const text="BEATCODES";
const lock=document.getElementById("lock");

[...text].forEach(char=>{
  const d=document.createElement("div");
  d.className="dial";
  const strip=document.createElement("div");
  strip.className="strip";

  for(let i=0;i<12;i++){
    const s=document.createElement("span");
    s.textContent=String.fromCharCode(65+Math.random()*26|0);
    strip.appendChild(s);
  }
  const final=document.createElement("span");
  final.textContent=char;
  strip.appendChild(final);

  d.appendChild(strip);
  lock.appendChild(d);

  setTimeout(()=>{
    strip.style.animation="none";
    strip.style.transform=`translateY(-${(strip.children.length-1)*80}px)`;
  },1000+Math.random()*400);
});

setTimeout(()=>document.getElementById("intro").style.opacity=0,2000);
setTimeout(()=>document.body.classList.add("open"),2300);
setTimeout(()=>document.getElementById("intro").remove(),3500);

/* ===== RECON FUNCTIONALITY (UNCHANGED) ===== */
let map, marker, circle;

async function run(){
  const t=document.getElementById("target").value;
  const out=document.getElementById("out");
  out.textContent="> Connecting...\n> Gathering intelligence...\n";

  const r=await fetch("/api/recon",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({target:t})
  });

  const j=await r.json();
  out.textContent+=JSON.stringify(j,null,2);

  if(j.geo?.lat && j.geo?.lon){
    if(!map){
      map=L.map("map").setView([j.geo.lat,j.geo.lon],7);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
    }else{
      map.setView([j.geo.lat,j.geo.lon],7);
      if(marker) map.removeLayer(marker);
      if(circle) map.removeLayer(circle);
    }

    marker=L.marker([j.geo.lat,j.geo.lon]).addTo(map);
    circle=L.circle([j.geo.lat,j.geo.lon],{
      radius:j.vpn_likelihood==="High"?90000:45000,
      color:"#00ff88",
      fillOpacity:.12
    }).addTo(map);
  }
}
</script>

</body>
</html>
